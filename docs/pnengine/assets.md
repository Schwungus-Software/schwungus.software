# Assets

## Image

Images can be used for UI graphics and as textures for primitives and materials. They are located in their own `images` folder and may come with an
optional JSON file that configures how the image should be displayed in-game.

An image will be automatically loaded if the material that uses it gets loaded.

### Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `frames` | Integer | `1` | The amount of frames the image consists of. |
| `x_offset` | Integer | `0` | The X offset of the image. |
| `y_offset` | Integer | `0` | The Y offset of the image. |
| `x_repeat` | Boolean | `true` | Whether or not to tile the image horizontally. |
| `y_repeat` | Boolean | `true` | Whether or not to tile the image vertically. |

## Material

Materials are JSON files in the `materials` folder that define how the game should display the surface of a model.

A material will be automatically loaded if the model that uses it gets loaded.

### Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `image` | Integer or String | `-1` | The name of the image to use as the texture. `-1` is considered a blank white texture. |
| `speed` | Float | `0` | The playback speed of the image in frames per millisecond. |
| `bright` | Float | `0` | Determines how much of the material is affected by lighting. |
| `x_scroll` | Float | `0` | The horizontal scrolling speed in full scrolls per millisecond. |
| `y_scroll` | Float | `0` | The vertical scrolling speed in full scrolls per millisecond. |
| `specular` | Float | `0` | The intensity of specular highlights. |
| `specular_exponent` | Float | `1` | Determines how "smooth" the material's surface is for specular highlights. Higher values mean smaller highlights. |
| `wind` | Float | `0` | Determines how much the material is affected by the level's wind. |
| `wind_lock_bottom` | Float | `1` | Determines how much of the material's bottom is unaffected by the wind. |
| `wind_speed` | Float | `1` | The swaying speed of the material under the wind. |
| `color` | Integer or Array | `16777215`, `[1, 1, 1]` or `[1, 1, 1, 1]` | The color to tint the material's texture with. Integers are considered BGR values and arrays have a red, green, blue and optional alpha component. |

## Model

Models are their own folders located in `models` with accompanying `model.json` files that define one or more submodels (`.mdl`) with materials assigned to them. Things can change the "skin index" of their model's submodels in order to hide or display different materials on them.

Collision meshes (`.col`) can also be assigned to models for use with levels and Movers. Each mesh can be assigned a surface ID and masks for each collision type (normal, vision, projectile, camera, etc.).

Animated models use Snidr's Model Format 1.0 animations (`.ani`) for skeletal animation. These will be automatically split into multiple samples at runtime.

### File Formats

#### Project Nightmare Model File (.mdl)

MDL files are headerless files that are generated by [PNEngine Model Converter](https://github.com/Schwungus-Software/PNMC).

The total size of each vertex is 44 bytes.

| Type | Size | Description |
| ---- | ---- | ----------- |
| `float32[3]` | `12` | XYZ Position |
| `float32[3]` | `12` | XYZ Normals |
| `float32[2]` | `8` | UV Coordinates |
| `uint8[4]` | `4` | Vertex Color |
| `uint8[2]` | `2` | Bone 1, Weight 1 |
| `uint8[2]` | `2` | Bone 2, Weight 2 |
| `uint8[2]` | `2` | Bone 3, Weight 3 |
| `uint8[2]` | `2` | Bone 4, Weight 4 |

#### Snidr's Model Format 1.0 Animation File (.ani)

ANI files are generated by [SMF Model Tool](https://forum.gamemaker.io/index.php?threads/smf-3d-skeletal-animation-now-with-a-custom-blender-exporter.19806/) through the `Export SMF v1` option.

#### Project Nightmare Collision Mesh File (.col)

COL files are headerless files that are generated by [PNEngine Model Converter](https://github.com/Schwungus-Software/PNMC).

The total size of each triangle is 48 bytes.

| Type | Size | Description |
| ---- | ---- | ----------- |
| `float32[3]` | `12` | XYZ Position of Vertex 1 |
| `float32[3]` | `12` | XYZ Position of Vertex 2 |
| `float32[3]` | `12` | XYZ Position of Vertex 3 |
| `float32[3]` | `12` | XYZ Normals of Triangle |

### Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `submodels` | Array | `N/A` | See [Submodel Properties](#submodel-properties) |
| `collisions` | Array | `N/A` | See [Collision Properties](#collision-properties) |
| `animations` | Array | `N/A` | See [Animation Properties](#animation-properties) |

### Submodel Properties

Each submodel is defined as a struct in the `submodels` array with the following properties:

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `name` | String | `N/A` | The name of the submodel file. |
| `materials` | Array | `N/A` | An array of the names of the materials the submodel can use. |
| `hidden` | Boolean | `false` | Whether or not to hide the submodel by default. |

### Collision Properties

Each collision mesh is defined as a struct in the `collisions` array with the following properties:

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `name` | String | `N/A` | The name of the collision mesh file. |
| `active` | Boolean | `true` | Whether or not to include this mesh in all collision checks. |
| `surface` | Integer | `0` | The surface ID of the mesh. `0` is considered "no surface". |
| `collision` | Boolean | `true` | Determines if this mesh can normally be collided with. |
| `collision_projectile` | Boolean | `true` | Determines if projectiles can collide with this mesh. |
| `collision_vision` | Boolean | `true` | Determines if this mesh is see-through. |
| `collision_camera` | Boolean | `true` | Determines if the camera can collide with this mesh. |

### Animation Properties

Each animation is defined as a struct in the `submodels` array with the
following properties:

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `name` | String | `N/A` | The name of the animation file. |
| `type` | Integer | `0` | The context the animation's samples are generated in. `0` = linear, `1` = linear loop, `2` = quadratic, `3` = quadratic loop |
| `frames` | Integer | `1` | The amount of samples to generate for the animation. Used as frames in-game. |
| `speed` | Float | `1` | The playback speed of the animation in frames per tick. |

## Font

Fonts are used for general text rendering. They are located in their own `fonts` folder, can be either bitmaps or TrueType, and are accompanied with a JSON file that defines how the fonts are rendered in-game.

### Properties

#### Bitmap Fonts

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `frames` | Integer | `1` | The amount of characters in the bitmap, in ASCII format. |
| `first` | String | `"!"` | The first character included in the bitmap. |
| `proportional` | Boolean | `true` | Whether or not to space the font based on the width of each character. |
| `space` | Integer | `true` | The amount of pixels to leave between each character. |

#### TrueType Fonts

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `size` | Float | `8` | The size of the font in pixels. |
| `bold` | Boolean | `false` | Determines whether or not the font should be rendered in bold. |
| `italics` | Boolean | `false` | Determines whether or not the font should be rendered in italics. |
| `first` | Integer | `32` | The first character to include from the font. |
| `last` | Integer | `128` | The last character to include from the font. |
| `smooth` | Boolean | `true` | Whether or not to smooth the edges of the font. |
| `sdf` | Boolean | `true` | Whether or not to use Signed Distance Field rendering for the font. |
| `sdf_spread` | Integer | `8` | The spread value of an SDF-enabled font in pixels. Lower values improve rendering precision and higher values allow effects with larger radii (i.e. glows). |

## Sound

Sounds can be processed in many ways. They can be played globally, in a specific location of an Area or from a Thing using an emitter. They can also be played with a base pitch, a random pitch offset and variable falloff.

Sounds are located in the `sounds` folder and can be 8/16-bit mono/stereo WAV
files with each one having an optional JSON file configuring how they're played in-game.

### Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `pitch` | Float or Array | `1` or `[1, 1]` | The base or randomized pitch of the sound. |
| `loop_start` | Float | `N/A` | Start of the loop in seconds. |
| `loop_end` | Float | `N/A` | End of the  loop in seconds. |

## Music

Music tracks are always played globally with a priority value, with the highest priority active track fading out lower ones. They can also contain metadata for special handling either by the game or through scripting.

Music tracks are located in the `music` folder and can be OGG files with each one having an optional JSON file configuring how they're played in-game.

### Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `loop_start` | Float | `N/A` | The starting loop point in seconds. |
| `loop_end` | Float | `N/A` | The ending loop point in seconds. |
| `metadata` | Struct | `N/A` | The metadata for the music track. |

## Script

Todo

## Level

Levels are JSON files in the `levels` folder that contain information on the
level itself and its contents. A level consists of one or more areas that can be displayed with a model and contains Things.

### Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `name` | String | `N/A` | The name to display in Discord's Rich Presence. Note that this will not be used in-game. The real name of the level is defined by `level.<filename>` in the game's current language. |
| `icon` | String | `N/A` | The icon to display in Discord's Rich Presence. |
| `areas` | Array | `N/A` | An array containing the structs of the level's areas. For properties, see [Area Properties](#area-properties). |

### Area Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `id` | Integer | `N/A` | The unique ID of the room. |
| `model` | String | `N/A` | The model to use for the area. |
| `things` | Array | `N/A` | An array containing the structs of the area's Things. For properties, see [Area Thing Properties](#area-thing-properties). |

### Area Thing Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `type` | String | `N/A` | The type of Thing to spawn. |
| `x` | Float | `0` | Initial X position. |
| `y` | Float | `0` | Initial Y position. |
| `z` | Float | `0` | Initial Z position. |
| `angle` | Float | `0` | Initial angle. |
| `tag` | Integer | `0` | The tag to use for i.e. level scripting. |
| `persistent` | Boolean | `false` | Whether or not the Thing's state will be the same upon re-entering the room. |
| `disposable` | Boolean | `false` | Whether or not the Thing will re-appear upon being destroyed and re-entering the room. |
| `special` | Struct | `N/A` | Special properties which may vary based on the Thing's type. |